#!/bin/bash
# Смотрим имеют ли исходные каталоги нужные разрешения для копирования
# (чтение для вводной и запись для выходной)
if [[ -r $1 && -w $2 ]]
then 
	# Создадим сквозной счётчик, чтобы избежать совпадение имён в файлах.
	# Таким образом, каждый файл при копировании будет иметь уникальное имя
	c=0
	# Переберём все возможные файлы и дирректори любой вложенности (и скрытые)
	# (с учётом разрешений на чтение)
	for v in $(find $1 2>/dev/null)
	do 
		# Если нет разрешения на чтения объекта, выведем сообщение
		if [ ! -r $v ]
		then
			echo tz1: $v: Permission denied
		# Если файл является ссылкой, не копируем и выводим сообщение
		elif [ -L $v ]
		then
			echo tz1: $v: file-link
		# Если объект является просто файлом и все разрешения есть, 
		# увеличиваем счётчик и копируем файл с изменением имени
		elif [ -f $v ]
		then
			let "c++"
			cp $v $2/$c-$(basename "$v")
		fi
	done

fi

# Если проблема с чтением из входного каталога, выведем сообщение
if [ ! -r $1 ]
then
	echo tz1: $1: Permission denied
fi
# Если проблема в записи в выходной каталог, выведем сообщение
if [ ! -w $2 ]
then
	echo tz1: $2: Permission denied
fi

